<html>
    <script>
        async function getUser(){
            try{
            //Get User Object from server
                let userRequest = new Request("api/User", {
                    method: "GET"
                });
                response = await fetch(userRequest);
                const user = await response.json();
                document.getElementById("Heading").innerHTML = "Hello, " + user.fname;
                return user;
            } catch (error) {
                console.error("ERROR:", error);
            }
            return null;
        }
        async function getChannels(user){
            try{
                //Get Channels from server
                let membershipRequest = new Request("api/Membership?user_id=" + user.id, {
                    method: "GET"
                });
                response = await fetch(membershipRequest);
                memberships = await response.json();
                //If memberships has a list of memberships
                if(memberships.list != null) memberships = memberships.list;
                else memberships = [memberships];
                console.log(memberships);
                for(let i = 0; i < memberships.length; i++){
                    let membership = memberships[i];
                    let li = document.createElement("li");
                    let a = document.createElement("a");
                    a.href = "channel.html?channel_id=" + membership.channel_id;
                    li.appendChild(a);
                    document.getElementById("channelList").appendChild(li);
                    channelRequest = new Request("api/Channel?id=" + membership.channel_id, {
                        method: "GET"
                    });
                    response = await fetch(channelRequest);
                    channel = await response.json();
                    a.innerHTML = channel.channel_name;
                }
            } catch (error) {
                console.error("ERROR:", error);
            }
        }
        async function load(){
            user = await getUser();
            if(user != null) getChannels(user);
        }
    </script>
    <body onload = "load()">
        <h1 id = "Heading"></h1>
        <h2>Channels</h2>
        <ul id = "channelList">
        </ul>
        <h2>Direct Messages</h2>
        <ul id = "DMList">
        </ul>
        <a href="createChannel.html">Create Channel</a>
        <a href="createDM.html">Direct Message</a>
        <form id="logout-form" method="post" action="logout">
            <button type="submit">Logout</button>
        </form>
    </body>
</html>